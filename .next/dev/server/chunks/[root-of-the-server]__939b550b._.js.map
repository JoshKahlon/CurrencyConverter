{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/joshkahlon/Desktop/git%20clone%20currencyconvert/CurrencyConverter/src/app/api/rate/route.ts"],"sourcesContent":["\nfunction toYMD(d: Date) {\n    return d.toISOString().slice(0,10);\n}\n\ntype Observation = { d: string; FXUSDCAD?: { v?: string } };\n\nfunction pickLatestRate(observations: Observation[]) {\n    for (let i = observations.length - 1; i >= 0; i--) {\n        const obs = observations[i];\n        const v = obs.FXUSDCAD?.v;\n        if (v!== undefined )\n        {\n            const numv = Number(v)\n            if (!Number.isNaN(numv)){\n\n                return { ratedate: obs.d, rate: numv };\n\n            }\n        }\n    }\n    throw new Error(\"Could Not Find A Rate !\");\n\n    \n\n  // loop from end to start\n  // find first obs where obs.FXUSDCAD?.v exists AND converts to a number (not NaN)\n  // return { rate: number, rateDate: string }\n  // if none found, throw an error\n}\n\n\n\n\nexport async function GET() {\n    const end = new Date();\n    const start = new Date(end);\n    start.setDate(start.getDate()-10);\n\n    \n    //call Bank of Canada Api to get most current exchange rate\n    const startStr = toYMD(start);\n    const endStr = toYMD(end);\n    const url = `https://www.bankofcanada.ca/valet/observations/FXUSDCAD/json?start_date=${startStr}&end_date=${endStr}`;\n    const res = await fetch(url);\n     if (!res.ok){\n        throw new Error(\"500 JSON Error\");     \n    }\n    const data = await res.json();\n\n\n    const { rate, ratedate } = pickLatestRate(data.observations);\n\n\n\n    return Response.json({rate,rateDate: ratedate,});\n}"],"names":[],"mappings":";;;;AACA,SAAS,MAAM,CAAO;IAClB,OAAO,EAAE,WAAW,GAAG,KAAK,CAAC,GAAE;AACnC;AAIA,SAAS,eAAe,YAA2B;IAC/C,IAAK,IAAI,IAAI,aAAa,MAAM,GAAG,GAAG,KAAK,GAAG,IAAK;QAC/C,MAAM,MAAM,YAAY,CAAC,EAAE;QAC3B,MAAM,IAAI,IAAI,QAAQ,EAAE;QACxB,IAAI,MAAK,WACT;YACI,MAAM,OAAO,OAAO;YACpB,IAAI,CAAC,OAAO,KAAK,CAAC,OAAM;gBAEpB,OAAO;oBAAE,UAAU,IAAI,CAAC;oBAAE,MAAM;gBAAK;YAEzC;QACJ;IACJ;IACA,MAAM,IAAI,MAAM;AAIlB,yBAAyB;AACzB,iFAAiF;AACjF,4CAA4C;AAC5C,gCAAgC;AAClC;AAKO,eAAe;IAClB,MAAM,MAAM,IAAI;IAChB,MAAM,QAAQ,IAAI,KAAK;IACvB,MAAM,OAAO,CAAC,MAAM,OAAO,KAAG;IAG9B,2DAA2D;IAC3D,MAAM,WAAW,MAAM;IACvB,MAAM,SAAS,MAAM;IACrB,MAAM,MAAM,CAAC,wEAAwE,EAAE,SAAS,UAAU,EAAE,QAAQ;IACpH,MAAM,MAAM,MAAM,MAAM;IACvB,IAAI,CAAC,IAAI,EAAE,EAAC;QACT,MAAM,IAAI,MAAM;IACpB;IACA,MAAM,OAAO,MAAM,IAAI,IAAI;IAG3B,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,eAAe,KAAK,YAAY;IAI3D,OAAO,SAAS,IAAI,CAAC;QAAC;QAAK,UAAU;IAAS;AAClD"}}]
}